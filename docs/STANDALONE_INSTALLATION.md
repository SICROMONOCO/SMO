# SMO Standalone Installation Guide

This guide covers installing SMO directly on your host system without Docker containerization.

## Overview

The standalone installation runs SMO and InfluxDB as native systemd services on your Linux host. This approach provides:

- ✅ Direct host installation (no containers)
- ✅ Automatic systemd service management
- ✅ Native InfluxDB installation and configuration
- ✅ Remote access enabled by default
- ✅ Easy backup and maintenance
- ✅ Lower resource overhead

## Prerequisites

- **Linux Operating System** (Ubuntu, Debian, Fedora, RHEL, CentOS, or Arch Linux)
- **Root/sudo access** (required for system installation)
- **Python 3.8 or later**
- **Internet connection** (for downloading packages)
- **At least 1GB free disk space**

## Quick Installation

### 1. Clone or download SMO

```bash
# If you have git
git clone https://github.com/SICROMONOCO/SMO.git
cd SMO

# Or download and extract the repository
```

### 2. Run the installation script

```bash
sudo ./setup-standalone.sh
```

The script will:
1. Detect your Linux distribution
2. Install Python dependencies
3. Install and configure InfluxDB
4. Set up SMO in `/opt/smo`
5. Create systemd services
6. Start all services automatically
7. Configure firewall rules (if applicable)

### 3. Access SMO

After installation completes:

- **Web Dashboard**: http://localhost:5000
- **InfluxDB UI**: http://localhost:8086

For remote access, use your server's IP address:
- **Web Dashboard**: http://YOUR_SERVER_IP:5000
- **InfluxDB UI**: http://YOUR_SERVER_IP:8086

## Installation Details

### Directory Structure

The standalone installation uses the following directories:

| Directory | Purpose | Owner |
|-----------|---------|-------|
| `/opt/smo` | Application files, Python venv | User who ran installer |
| `/etc/smo` | Configuration files (symlink to /opt/smo/config) | User who ran installer |
| `/var/log/smo` | Application logs | User who ran installer |
| `/var/lib/smo/influxdb` | InfluxDB data storage | influxdb user |

### Systemd Services

Three systemd services are created:

1. **influxdb.service** - InfluxDB database server
2. **smo-agent.service** - SMO metrics collection agent
3. **smo-web.service** - SMO web dashboard

Services start automatically on boot and restart on failure.

### Environment Configuration

Configuration is stored in `/opt/smo/.env`:

```bash
INFLUXDB_URL=http://localhost:8086
INFLUXDB_TOKEN=<auto-generated>
INFLUXDB_ORG=smo-org
INFLUXDB_BUCKET=smo-metrics
INFLUXDB_ADMIN_USER=admin
INFLUXDB_ADMIN_PASSWORD=<auto-generated>
HOST_MONITOR=true
```

**Important:** Save your credentials! They are displayed during installation and stored in `/opt/smo/.env`.

## Managing Services

### View Service Status

```bash
# Check all SMO services
sudo systemctl status smo-agent smo-web influxdb

# Check individual service
sudo systemctl status smo-agent
```

### Start/Stop Services

```bash
# Stop all services
sudo systemctl stop smo-agent smo-web influxdb

# Start all services (in correct order)
sudo systemctl start influxdb smo-agent smo-web

# Restart a service
sudo systemctl restart smo-agent
```

### Enable/Disable Auto-start

```bash
# Disable auto-start on boot
sudo systemctl disable smo-agent smo-web

# Re-enable auto-start
sudo systemctl enable smo-agent smo-web
```

### View Logs

```bash
# View agent logs (real-time)
sudo journalctl -u smo-agent -f

# View web dashboard logs
sudo journalctl -u smo-web -f

# View InfluxDB logs
sudo journalctl -u influxdb -f

# View all SMO logs
sudo journalctl -u smo-agent -u smo-web -f

# View last 100 lines
sudo journalctl -u smo-agent -n 100
```

## Using the TUI Dashboard

The TUI (Text User Interface) dashboard runs interactively in your terminal:

```bash
cd /opt/smo
source venv/bin/activate
python3 -m tui.tui_dashboard
```

Press `Ctrl+C` or `q` to exit.

## Remote Access Configuration

### Firewall Configuration

The installation script automatically configures firewall rules if UFW or firewalld is detected. Manual configuration:

**UFW (Ubuntu/Debian):**
```bash
sudo ufw allow 5000/tcp comment 'SMO Web Dashboard'
sudo ufw allow 8086/tcp comment 'InfluxDB'
sudo ufw enable
```

**Firewalld (Fedora/RHEL/CentOS):**
```bash
sudo firewall-cmd --permanent --add-port=5000/tcp
sudo firewall-cmd --permanent --add-port=8086/tcp
sudo firewall-cmd --reload
```

**iptables (manual):**
```bash
sudo iptables -A INPUT -p tcp --dport 5000 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8086 -j ACCEPT
sudo iptables-save > /etc/iptables/rules.v4
```

### Cloud/VPS Additional Steps

If running on a cloud provider (AWS, Azure, GCP, etc.), you may also need to:

1. **Configure Security Groups** (AWS) or equivalent to allow inbound traffic on ports 5000 and 8086
2. **Set up reverse proxy** (recommended for production):

**Nginx Example:**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

3. **Configure SSL/TLS** for secure remote access

## Configuration

### Modifying Settings

Edit the configuration file:

```bash
sudo nano /opt/smo/config/config.yaml
```

After changes, restart the agent:

```bash
sudo systemctl restart smo-agent
```

### Environment Variables

Edit environment file:

```bash
sudo nano /opt/smo/.env
```

After changes, restart services:

```bash
sudo systemctl restart smo-agent smo-web
```

### InfluxDB Configuration

InfluxDB configuration is in `/etc/influxdb/config.toml`. After editing:

```bash
sudo systemctl restart influxdb
```

## Backup and Restore

### Backup SMO Configuration

```bash
# Backup configuration
sudo tar -czf smo-config-backup.tar.gz /opt/smo/config /opt/smo/.env

# Backup InfluxDB data
sudo systemctl stop influxdb
sudo tar -czf influxdb-backup.tar.gz /var/lib/smo/influxdb
sudo systemctl start influxdb
```

### Restore from Backup

```bash
# Restore configuration
sudo tar -xzf smo-config-backup.tar.gz -C /

# Restore InfluxDB data
sudo systemctl stop influxdb
sudo tar -xzf influxdb-backup.tar.gz -C /
sudo systemctl start influxdb
sudo systemctl restart smo-agent smo-web
```

## Updating SMO

To update to a newer version:

```bash
cd /path/to/new/SMO
sudo systemctl stop smo-agent smo-web

# Backup current installation
sudo cp -r /opt/smo /opt/smo.backup

# Copy new files
sudo cp -r *.py /opt/smo/
sudo cp -r metrics /opt/smo/
sudo cp -r tui /opt/smo/

# Update dependencies
cd /opt/smo
source venv/bin/activate
pip install --upgrade -r requirements.txt

# Restart services
sudo systemctl start smo-agent smo-web
```

## Uninstalling

To completely remove SMO:

```bash
cd /path/to/SMO
sudo ./uninstall-standalone.sh
```

The uninstall script will:
1. Stop all SMO services
2. Remove systemd service files
3. Delete SMO directories
4. Optionally remove InfluxDB
5. Optionally remove InfluxDB data

## Troubleshooting

### Services fail to start

**Check logs:**
```bash
sudo journalctl -u smo-agent -n 50
sudo journalctl -u smo-web -n 50
sudo journalctl -u influxdb -n 50
```

**Common issues:**
- InfluxDB not running: `sudo systemctl start influxdb`
- Port already in use: Check with `sudo netstat -tlnp | grep -E '5000|8086'`
- Permission issues: Check file ownership in `/opt/smo`

### Cannot connect to InfluxDB

**Verify InfluxDB is running:**
```bash
sudo systemctl status influxdb
curl http://localhost:8086/health
```

**Check InfluxDB initialization:**
```bash
influx auth list
```

**Re-initialize if needed:**
```bash
influx setup \
  --username admin \
  --password YOUR_PASSWORD \
  --org smo-org \
  --bucket smo-metrics \
  --token YOUR_TOKEN \
  --force
```

### Web dashboard shows "No data"

**Check agent is running and collecting metrics:**
```bash
sudo systemctl status smo-agent
sudo journalctl -u smo-agent -f
```

**Verify data in InfluxDB:**
```bash
influx query 'from(bucket:"smo-metrics") |> range(start:-1h) |> limit(n:10)'
```

### High memory/CPU usage

**Check resource limits:**
```bash
sudo systemctl status smo-agent
```

**Adjust refresh intervals in config:**
```bash
sudo nano /opt/smo/config/config.yaml
# Increase refresh intervals for less frequent updates
```

### Permission denied errors

**Fix ownership:**
```bash
sudo chown -R $(whoami):$(whoami) /opt/smo
sudo chown -R $(whoami):$(whoami) /var/log/smo
```

## Performance Tuning

### For Low-Resource Systems

Edit `/opt/smo/config/config.yaml`:

```yaml
refresh:
  cpu: 5        # Increase from 2
  memory: 10    # Increase from 5
  disk: 30      # Increase from 10
  network: 10   # Increase from 5
  process: 5    # Increase from 2
```

### For High-Performance Systems

Reduce refresh intervals for more frequent updates:

```yaml
refresh:
  cpu: 1
  memory: 2
  disk: 5
  network: 2
  process: 1
```

## Security Considerations

### Production Deployment

1. **Change default passwords** in `/opt/smo/.env`
2. **Use strong tokens** (64+ character random strings)
3. **Enable HTTPS** with reverse proxy
4. **Restrict firewall** to specific IPs if possible
5. **Regular backups** of configuration and data
6. **Monitor logs** for unusual activity

### Restricting Access

Bind services to localhost only (edit systemd service files):

**smo-web.service:**
```
ExecStart=/opt/smo/venv/bin/uvicorn web_dashboard:app --host 127.0.0.1 --port 5000
```

Then use SSH tunneling for remote access:
```bash
ssh -L 5000:localhost:5000 -L 8086:localhost:8086 user@server
```

## Comparison: Standalone vs Docker

| Feature | Standalone | Docker |
|---------|-----------|--------|
| Installation complexity | Medium | Low |
| Resource overhead | Lower | Higher |
| Isolation | No | Yes |
| Updates | Manual | Rebuild image |
| Backup | Native tools | Volume backups |
| Integration with host | Native | Through volumes |
| Multi-instance | Complex | Easy |
| Portability | OS-specific | Cross-platform |

Choose standalone when:
- ✅ Running on a dedicated server
- ✅ Need lower resource overhead
- ✅ Want native systemd integration
- ✅ Prefer traditional service management

Choose Docker when:
- ✅ Need isolation from host
- ✅ Want easy updates/rollbacks
- ✅ Running multiple instances
- ✅ Deploying across different systems

## Additional Resources

- [Main README](../README.md) - General SMO documentation
- [CONTAINERIZATION.md](../CONTAINERIZATION.md) - Docker setup guide
- [USAGE.md](../USAGE.md) - Application usage guide
- [InfluxDB Documentation](https://docs.influxdata.com/influxdb/v2/)

## Getting Help

If you encounter issues:

1. Check this documentation
2. Review logs: `sudo journalctl -u smo-agent -u smo-web -u influxdb`
3. Check service status: `sudo systemctl status smo-agent smo-web influxdb`
4. Verify configuration: `/opt/smo/.env` and `/opt/smo/config/config.yaml`
5. Open an issue on GitHub with logs and error messages
